<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Global Hoy</title>
  <link rel="stylesheet" href="estilos.css" />
</head>
<body>
  <!-- Menú desplegable de usuario -->
  <header>
    <h1> Global Hoy</h1>
    <div class="user-menu">
      <button id="menu-toggle">☰ Usuario</button>
      <div class="dropdown-menu" id="dropdown">
        <a href="#">Noticias por país</a>
        <a href="#">Cambio de idioma</a>
        <a href="#">Historial y favoritos</a>
        <a href="#">Notificaciones</a>
        <a href="#">Cerrar sesión</a>
      </div>
    </div>
  </header>

  <!-- Bienvenida -->
  <section>
    <h1>Welcome to Global Hoy</h1>
    <p>Tu fuente de noticias locales e internacionales, personalizadas por país y en tu idioma.</p>
  </section>

  <!-- Contenedor unificado de noticias -->
  <section id="noticiasContainer">
    <h2>Cargando noticias...</h2>
  </section>

  <!-- Anuncios Locales -->
  <section id="anuncio-local">
    <h3>Anuncio para <span id="pais-anuncio">tu país</span></h3>
    <p id="contenido-anuncio">...</p>
  </section>

  <!-- Suscripción -->
  <section>
    <h2>Subscribe to News</h2>
    <input type="email" placeholder="Enter your email" id="email-input" />
    <button onclick="suscribirse()">Subscribe to News</button>
  </section>

  <!-- Script de detección + carga -->
  <script>
    // Mostrar modal de país
    function cambiarPais() {
      document.getElementById("modalPais").style.display = "block";
    }

    // Mostrar modal de idioma
    function cambiarIdioma() {
      document.getElementById("modalIdioma").style.display = "block";
    }

    // Guardar país y recargar noticias
    function guardarPais() {
      const pais = document.getElementById("paisSelect").value;
      localStorage.setItem("paisSeleccionado", pais);
      location.reload();
    }

    // Guardar idioma
    function guardarIdioma() {
      const idioma = document.getElementById("idiomaSelect").value;
      localStorage.setItem("idiomaSeleccionado", idioma);
      location.reload();
    }

    // Cargar noticias automáticamente por país
    document.addEventListener("DOMContentLoaded", () => {
      const pais = localStorage.getItem("paisSeleccionado") || "us";
      const idioma = localStorage.getItem("idiomaSeleccionado") || "en";

      // Cargar noticias locales
      fetch(`public/noticias/${pais}.json`)
        .then(res => res.json())
        .then(data => mostrarNoticias(data, idioma))
        .catch(() => console.warn("No se pudieron cargar noticias del país."));

      // Cargar anuncios
      cargarAnuncios(pais);

      // Lógica para el menú desplegable
    document.addEventListener('DOMContentLoaded', function() {
      const menuToggle = document.getElementById("menu-toggle");
      const dropdown = document.getElementById("dropdown");

      if (menuToggle && dropdown) {
        menuToggle.addEventListener("click", function () {
          dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
        });
      }

      // Cerrar modales al hacer clic fuera de ellos
      window.onclick = function(event) {
        const modalPais = document.getElementById('modalPais');
        const modalIdioma = document.getElementById('modalIdioma');
        if (event.target == modalPais) {
          modalPais.style.display = 'none';
        }
        if (event.target == modalIdioma) {
          modalIdioma.style.display = 'none';
        }
      };
    });
    });

    // Esta función ya debe estar, pero si no:
    function mostrarNoticias(data, idioma) {
      const contenedor = document.getElementById("noticiasContainer");
      contenedor.innerHTML = "";
      data.forEach(noticia => {
        const div = document.createElement("div");
        div.innerHTML = `<h3>${noticia.titulo}</h3><p>${noticia.descripcion}</p>`;
        contenedor.appendChild(div);
      });
    }

    // Funciones de utilidad (mantener si no están en archivos JS externos)
    function suscribirse() {
      const email = document.getElementById('email-input').value;
      alert(`Gracias por suscribirte con: ${email}`);
      // Aquí puedes enviar el email a tu base de datos o API
    }

    function cargarAnuncios(pais) {
      const anuncios = {
        do: "¡Disfruta de nuestras noticias desde República Dominicana!",
        us: "Noticias importantes para ti desde EE.UU.",
        es: "Lo último que pasa en España, aquí en Global Hoy"
      };
      document.getElementById('pais-anuncio').textContent = pais.toUpperCase();
      document.getElementById('contenido-anuncio').textContent = anuncios[pais] || "Bienvenido a Global Hoy.";
    }

    function verFavoritos() {
      const favoritos = JSON.parse(localStorage.getItem("favoritos")) || [];
      alert("Favoritos: " + favoritos.join(", "));
    }

    function verHistorial() {
      const historial = JSON.parse(localStorage.getItem("historial")) || [];
      alert("Historial: " + historial.join(", "));
    }

    function toggleNotificaciones() {
      const estado = localStorage.getItem("notificaciones") === "on";
      localStorage.setItem("notificaciones", estado ? "off" : "on");
      alert("Notificaciones " + (estado ? "desactivadas" : "activadas"));
    }

    function cerrarSesion() {
      alert("Sesión cerrada (esto es un ejemplo).");
    }
  </script>
  <script src="js/cookies.js"></script>
  <script src="js/favoritos.js"></script>
  <script src="js/historial.js"></script>
  <script src="js/notificaciones.js"></script>
  <!-- Modal para cambiar país -->
<div id="modalPais" class="modal">
  <div class="modal-content">
    <h3>Selecciona tu país</h3>
    <select id="paisSelect">
      <option value="us">Estados Unidos</option>
      <option value="es">España</option>
      <option value="do">República Dominicana</option>
    </select>
    <button onclick="guardarPais()">Guardar</button>
  </div>
</div>

<!-- Modal para cambiar idioma -->
<div id="modalIdioma" class="modal">
  <div class="modal-content">
    <h3>Selecciona tu idioma</h3>
    <select id="idiomaSelect">
      <option value="es">Español</option>
      <option value="en">English</option>
    </select>
    <button onclick="guardarIdioma()">Guardar</button>
  </div>
</div>

</body>
</html>